---

# elixir_ls

- name: create pkg dir
  file: 
    path: /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_version}}
    state: directory 
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: get elixir_ls zip file
  get_url: 
    url: https://github.com/elixir-lsp/elixir-ls/releases/download/v{{els_version}}/elixir-ls.zip
    dest: /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_version}}.zip 
    force: no
    validate_certs: false
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: unzip elixir_ls file
  unarchive:
    src:  /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_version}}.zip
    dest: /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_version}}
    remote_src: true
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: set script permission
  file:
    path: /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_version}}/language_server.sh
    mode:  "a+rx"
    state: touch
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: create elixir_ls symlink
  file: 
    src:   /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_version}}/language_server.sh
    dest:  /usr/local/bin/elixir_ls
    state: link
    force: yes

- name: create release symlink
  file: 
    src:   /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_version}}
    dest:  /home/{{gen_user}}/.pkg/elixir_ls/rel
    state: link
    force: yes
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

