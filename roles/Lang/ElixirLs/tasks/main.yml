---

# elixir_ls

- name: create pkg dir
  file: 
    path: /home/{{gen_user}}/.pkg/elixir_ls
    state: directory 
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: get elixir_ls release file
  get_url: 
    url: http://{{cblob_host}}/elixir_ls/vsn_{{els_vsn}}/els_{{els_vsn}}.tar
    dest: /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_vsn}}.tar
    force: no
    validate_certs: false
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: untar release file
  unarchive:
    src:  /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_vsn}}.tar
    dest: /home/{{gen_user}}/.pkg/elixir_ls/
    remote_src: true
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: set script permission
  file:
    path: /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_vsn}}/language_server.sh
    mode:  "a+rx"
    state: touch
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

- name: create elixir_ls symlink
  file: 
    src:   /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_vsn}}/language_server.sh
    dest:  /usr/local/bin/elixir_ls
    state: link
    force: yes

- name: create release symlink
  file: 
    src:   /home/{{gen_user}}/.pkg/elixir_ls/els_{{els_vsn}}
    dest:  /home/{{gen_user}}/.pkg/elixir_ls/rel
    state: link
    force: yes
    group: "{{gen_user}}" 
    owner: "{{gen_user}}"

