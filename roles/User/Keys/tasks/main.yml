---

# SSH Key Provisioning for GitHub and Filestore

- name: Fetch ssh pubkey
  fetch:
    src: "{{tgt_keyfile}}"
    dest: "{{lcl_keyfile}}"
    flat: yes

- name: Copy GitHub Configuration
  copy:
    src: /home/aleak/{{item}}
    dest: /home/{{gen_user}}/{{item}}
    owner: "{{gen_user}}"
    group: "{{gen_user}}"
    force: no
  with_items:
    - .gitconfig
    - .gitconfig_user

- name: Copy pubkey to GitHub
  local_action: command gh_keycopy {{tgt_basename}} {{lcl_keyfile}}
  become: false

- name: Copy pubkey to {{filehost}}
  local_action: command keycopy {{gen_user}}@{{filehost}} -f {{lcl_keyfile}}
  become: false

- name: Copy pubkey to {{influxdb_hostname}}
  local_action: command keycopy {{gen_user}}@{{influxdb_hostname}} -f {{lcl_keyfile}}
  become: false

